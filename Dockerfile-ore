FROM debian:latest as builder
ENV PATH "$PATH:/root/.cargo/bin"
WORKDIR /app
RUN apt-get -y update &&\
    apt-get install -y git curl gcc &&\
    curl https://sh.rustup.rs -sSf | sh -s -- -y &&\
    git clone https://github.com/HardhatChad/ore-cli.git &&\
    cd ore-cli &&\
    git fetch origin pull/4/head:pr4 &&\
    git checkout pr4 &&\
    cargo build --release &&\
    sed -Ie 's/bus_id = 0/bus_id = 5/g' src/mine.rs &&\
    mv ./target/release/ore /app

FROM debian:latest as prod
WORKDIR /app
COPY --from=0 /app/ore .
ENTRYPOINT /app/ore


